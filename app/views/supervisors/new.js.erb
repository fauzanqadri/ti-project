var html = "<%= j render('form') %>";
var facultyModal = $("#supervisor-modal");
if (facultyModal.length == 1) {
	facultyModal.modal("hide");
	facultyModal.on('hidden.bs.modal', function(e){
		$(e.target).remove();
		$("body").append(html);
		$("#supervisor-modal").modal({show: true});
	});
}else{
	$("body").append(html);
	$("#supervisor-modal").modal({show: true});	
}

var autoComplete = $("#lecturer_name").autocomplete({
	appendTo: "#supervisor-modal .modal-footer",
	minLength: 2,
	autoFocus: true,
	source: function(req, resp){
		$.ajax({
			url: "<%= search_lecturers_path %>",
			dataType: "json",
			data: {query: req.term},
			success: function(data){
				resp($.map(data, function(item){
					return {
						value: item.id,
						label: item.full_name,
						supervisors_skripsi_count: item.supervisors_skripsi_count,
						supervisors_pkl_count: item.supervisors_pkl_count,
						photo: item.photo,
						level: item.level
					}
				}));
			}
		});
	},
	focus: function(event, ui){
		$("#lecturer_name").val(ui.item.label);
		return false;
	},
	select: function(event, ui){
		$("#lecturer_name").val(ui.item.label);
		$("#supervisor_lecturer_id").val(ui.item.value);
		return false;
	}
}).data("ui-autocomplete");

autoComplete._renderItem =  function(ul, item){
	html = JST['templates/lecturer_search'];
	return $(html(item)).appendTo(ul);
}

